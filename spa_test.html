<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>我的博客 SPA (Vue版)</title>
    <!-- 1. 引入 Bootstrap 样式 (为了好看) -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .loading { text-align: center; margin-top: 50px; color: #666; }
        .blog-card { transition: transform 0.2s; }
        .blog-card:hover { transform: translateY(-5px); }
    </style>
</head>
<body>

<div id="app" class="container py-5">
    <h1 class="mb-4">极速博客 (前端分离版)</h1>
    
    <!-- 搜索框 -->
    <div class="mb-4">
        <input type="text" class="form-control" v-model="searchQuery" @input="fetchPosts" placeholder="输入关键词实时搜索...">
    </div>

    <!-- 加载状态 -->
    <div v-if="loading" class="loading">
        <div class="spinner-border text-primary" role="status"></div>
        <p>数据加载中...</p>
    </div>

    <!-- 列表展示 -->
    <div v-else class="row">
        <div class="col-md-6 mb-4" v-for="post in posts" :key="post.id">
            <div class="card h-100 shadow-sm blog-card">
                <div class="card-body">
                    <h5 class="card-title">{{ post.title }}</h5>
                    <h6 class="card-subtitle mb-2 text-muted">作者: {{ post.author.username }}</h6>
                    <p class="card-text text-secondary">
                        <!-- Vue 没有 truncate，我们简单截取 -->
                        {{ post.slug }}... (点击查看详情)
                    </p>
                    <small class="text-muted">{{ formatDate(post.created_at) }}</small>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 空状态 -->
    <div v-if="!loading && posts.length === 0" class="text-center text-muted">
        没有找到相关文章。
    </div>
</div>

<!-- 2. 引入 Vue 3 -->
<script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>

<script>
    const { createApp } = Vue

    createApp({
        data() {
            return {
                posts: [],
                loading: true,
                searchQuery: ''
            }
        },
        mounted() {
            // 页面一加载就去取数据
            this.fetchPosts()
        },
        methods: {
            async fetchPosts() {
                this.loading = true
                
                // 3. 核心：调用你的 Django API
                // 注意：这里我们直接访问 127.0.0.1:8000
                let url = 'http://127.0.0.1:8000/api/posts/'
                
                // 如果有搜索词，拼接到 URL
                if (this.searchQuery) {
                    url += `?search=${this.searchQuery}`
                }

                try {
                    const response = await fetch(url)
                    const data = await response.json()
                    this.posts = data
                } catch (error) {
                    console.error('Error:', error)
                    alert('无法连接到 API，请确保 Django 服务器已启动！')
                } finally {
                    this.loading = false
                }
            },
            formatDate(dateStr) {
                return new Date(dateStr).toLocaleDateString()
            }
        }
    }).mount('#app')
</script>

</body>
</html>