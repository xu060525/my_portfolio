<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>{{ project.title }} - 详情</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
</head>
<body>
    <!-- 简单的导航栏 -->
     <nav class="navbar navbar-dark bg-primary mb-4">
        <div class="container">
            <a class="navbar-brand" href="{% url 'home' %}">返回首页</a>
        </div>
     </nav>

     <div class="container">
        <div class="row">
            <!-- 左侧：图片 -->
             <div class="col-md-6">
                {% if project.image %}
                <img src="{{ project.image.url }}" class="img-fluid rounded" alt="{{ project.title }}">
                {% endif %}
             </div>

             <!-- 右侧：信息与下载 -->
             <div class="col-md-6">
                <h1 class="mb-3">{{ project.title }}</h1>
                <p class="text-muted">发布时间：{{ project.created_at|date:"Y-m-d H:i" }}</p>

                <hr>

                <div class="mb-4">
                    <h5>项目介绍：</h5>
                    <!-- linebreaks 过滤器能把文本里的换行符转换成 HTML 的 <br> 或 <p> -->
                     <p>{{ project.description|linebreaks }}</p>
                </div>

                <!-- 按按钮 -->
                 <div class="d-grid gap-2">
                    <!-- 原来的下载按钮代码删掉，换成下面的 -->
                    <h3 class="mt-5 mb-3">版本历史 & 下载</h3>

                    {% if project.versions.all %}
                        <div class="table-responsive">
                            <table class="table table-hover table-bordered">
                                <thead class="table-light">
                                    <tr>
                                        <th>版本号</th>
                                        <th>发布时间</th>
                                        <th>更新日志</th>
                                        <th>操作</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- 这里的 .versions.all 就是我们在 models 里定义的 related_name -->
                                    {% for version in project.versions.all %}
                                    <tr>
                                        <td><strong>{{ version.version_name }}</strong></td>
                                        <td>{{ version.created_at|date:"Y-m-d" }}</td>
                                        <td>
                                            <!-- 显示前 30 个字，鼠标悬停显示全部 -->
                                            <span title="{{ version.release_note }}">
                                                {{ version.release_note|truncatechars:30 }}
                                            </span>
                                        </td>
                                        <td>
                                            <a href="{{ version.file.url }}" class="btn btn-success btn-sm" download>
                                                下载
                                            </a>
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    {% else %}
                        <div class="alert alert-warning">
                            暂无发布版本，敬请期待。
                        </div>
                    {% endif %}

                    <!-- GitHub 按钮 -->
                     {% if project.github_link %}
                     <a href="{{ project.github_link }}" class="btn btn-dark" target="_blank">
                        查看 GitHub 源码
                     </a>
                     {% endif %}
                 </div>
             </div>
        </div>
     </div>
</body>
</html>