{% extends 'main/base.html' %}

{% block title %}{{ post.title }}{% endblock %}
{% block meta_description %}{{ post.content|striptags|truncatechars:150 }}{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-lg-8"> <!-- é™åˆ¶å®½åº¦ï¼Œæå‡é˜…è¯»ä½“éªŒ -->
        
        <!-- 1. é¡¶éƒ¨å…ƒä¿¡æ¯åŒº -->
        <nav aria-label="breadcrumb" class="mt-4">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="{% url 'blog:list' %}" class="text-decoration-none">åšå®¢</a></li>
                <li class="breadcrumb-item active" aria-current="page">{{ post.title|truncatechars:20 }}</li>
            </ol>
        </nav>

        <header class="mb-5 mt-4">
            <h1 class="fw-bold display-5 mb-3 text-dark">{{ post.title }}</h1>
            <div class="d-flex align-items-center text-muted">
                <!-- è¿™é‡Œçš„ä½œè€…å¦‚æœæ²¡å…³è” Userï¼Œå¯ä»¥ç”¨é™æ€åå­— -->
                <i class="bi bi-person-circle me-2"></i> 
                <span class="me-3">å¾æºç¿”</span>
                <i class="bi bi-calendar3 me-2"></i>
                <span>{{ post.created_at|date:"Yå¹´mæœˆdæ—¥" }}</span>
                
                <!-- æ ‡ç­¾ (å¦‚æœæœ‰çš„è¯) -->
                {% if post.tags.all %}
                <span class="mx-2">|</span>
                {% for tag in post.tags.all %}
                    <span class="badge bg-light text-secondary border ms-1">{{ tag.name }}</span>
                {% endfor %}
                {% endif %}
            </div>
        </header>

        <!-- 2. æ­£æ–‡åŒº (Chrome é£æ ¼ï¼šå¤§è¡Œé«˜ï¼Œè¡¬çº¿ä½“å¯é€‰) -->
        <article class="blog-content fs-5 lh-lg text-break mb-5">
            <!-- å‡è®¾ä½ ç”¨äº† markdown æ¸²æŸ“ï¼Œè¿™é‡Œç›´æ¥è¾“å‡º HTML -->
            {{ post.content|safe }}
        </article>
        
        <!-- 3. ç‚¹èµäº¤äº’åŒº (Floating Action Button é£æ ¼) -->
        <div class="text-center my-5 py-4 border-top border-bottom">
            <p class="text-muted mb-3 small">å¦‚æœä½ è§‰å¾—è¿™ç¯‡æ–‡ç« æœ‰å¸®åŠ©ï¼Œä¸å¦¨ç‚¹ä¸ªèµæ”¯æŒä¸€ä¸‹ ğŸ‘‡</p>
            <button class="btn btn-outline-danger btn-lg rounded-pill px-5 py-2 shadow-sm transition-btn" id="like-btn" data-id="{{ post.id }}">
                <i class="bi bi-heart-fill me-2"></i> 
                <span id="like-text">ç‚¹èµ</span> 
                <span class="badge bg-danger text-white ms-2 rounded-pill" id="like-count">{{ post.likes_count }}</span>
            </button>
        </div>

        <!-- 4. è¯„è®ºåŒº (ä¿æŒä½ ä¹‹å‰çš„é€»è¾‘ï¼Œæ ·å¼å¾®è°ƒ) -->
        <section class="comment-section bg-light rounded-4 p-4 p-md-5 mb-5">
            <h3 class="fw-bold mb-4">
                <i class="bi bi-chat-quote-fill text-primary"></i> è¯„è®º ({{ comments.count }})
            </h3>

            <!-- è¯„è®ºåˆ—è¡¨ -->
            <div class="mb-5">
                {% for comment in comments %}
                <div class="d-flex mb-4 p-3 bg-white rounded-3 shadow-sm">
                    <div class="flex-shrink-0">
                        <div class="rounded-circle bg-primary text-white d-flex align-it